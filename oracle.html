<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ORACLE v3.0 | Ecosystem — Distributed Nervous System</title>
    <meta name="description" content="ORACLE v3.0 - Distributed Nervous System. Three-level intelligence: Sensory, Synaptic, Cortical. Browser-native. Local memory. Zero cloud.">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;900&family=Share+Tech+Mono&family=Inter:wght@300;400;500;600&display=swap');

        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --bg-deep: #070d1a;
            --bg-card: #0b1526;
            --bg-card-hover: #0e1a30;
            --border: #152240;
            --border-light: #1a2d50;
            --cyan: #00c8ff;
            --cyan-dim: #0088aa;
            --teal: #00d4aa;
            --red: #ff3344;
            --red-dim: #cc2233;
            --orange: #ff8833;
            --yellow: #ffcc00;
            --green: #00dd66;
            --purple: #8855ff;
            --pink: #ff0084;
            --text-primary: #c8d6e5;
            --text-secondary: #6b7fa3;
            --text-dim: #3a4f6f;
        }

        body {
            font-family: 'Inter', 'Share Tech Mono', sans-serif;
            background: var(--bg-deep);
            color: var(--text-primary);
            overflow-x: hidden;
            min-height: 100vh;
            line-height: 1.5;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: repeating-linear-gradient(
                0deg, transparent, transparent 3px,
                rgba(0, 200, 255, 0.008) 3px, rgba(0, 200, 255, 0.008) 6px
            );
            pointer-events: none;
            z-index: 999;
        }

        /* ===== HEADER ===== */
        .top-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 24px;
            background: #060c18;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .top-header-left {
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .oracle-logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .pulse-icon {
            width: 28px;
            height: 28px;
        }

        .pulse-icon svg {
            width: 28px;
            height: 28px;
        }

        .pulse-line {
            stroke: var(--cyan);
            stroke-width: 2;
            fill: none;
            filter: drop-shadow(0 0 4px var(--cyan));
        }

        .oracle-title {
            font-family: 'Orbitron', monospace;
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--cyan);
            letter-spacing: 0.12em;
        }

        .oracle-subtitle {
            font-size: 0.6rem;
            color: var(--text-dim);
            letter-spacing: 0.08em;
            text-transform: uppercase;
            margin-top: 1px;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .btn-scan {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.65rem;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            padding: 6px 16px;
            background: rgba(0, 200, 255, 0.1);
            border: 1px solid var(--cyan-dim);
            color: var(--cyan);
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-scan:hover {
            background: rgba(0, 200, 255, 0.2);
            box-shadow: 0 0 12px rgba(0, 200, 255, 0.2);
        }

        .btn-scan:disabled {
            opacity: 0.4;
            cursor: wait;
        }

        .btn-scan.scanning {
            animation: pulse-btn 1s infinite;
        }

        @keyframes pulse-btn {
            0%, 100% { border-color: var(--cyan-dim); }
            50% { border-color: var(--cyan); box-shadow: 0 0 16px rgba(0, 200, 255, 0.3); }
        }

        .auto-toggle {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.6rem;
            color: var(--text-dim);
            letter-spacing: 0.06em;
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
        }

        .auto-toggle .dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--text-dim);
            transition: all 0.3s;
        }

        .auto-toggle.active .dot {
            background: var(--green);
            box-shadow: 0 0 6px var(--green);
        }

        .back-link {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.65rem;
            color: var(--text-dim);
            text-decoration: none;
            letter-spacing: 0.08em;
            transition: color 0.3s;
        }

        .back-link:hover { color: var(--cyan); }

        /* ===== MAIN CONTAINER ===== */
        .main-container {
            padding: 24px;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* ===== SECTION LABEL ===== */
        .section-label {
            font-family: 'Orbitron', monospace;
            font-size: 0.6rem;
            font-weight: 600;
            color: var(--text-dim);
            letter-spacing: 0.18em;
            text-transform: uppercase;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-label .level-num {
            color: var(--cyan);
            font-size: 0.7rem;
            font-weight: 700;
        }

        .section-label::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border);
        }

        /* ===== STABILITY FIELD (HERO) ===== */
        .stability-hero {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 28px 32px;
            margin-bottom: 24px;
            position: relative;
            overflow: hidden;
        }

        .stability-hero::before {
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 2px;
            background: linear-gradient(90deg, var(--cyan), var(--teal), var(--cyan));
            opacity: 0.5;
        }

        .stability-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .stability-title-area h2 {
            font-family: 'Orbitron', monospace;
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--text-secondary);
            letter-spacing: 0.15em;
            text-transform: uppercase;
            margin-bottom: 4px;
        }

        .stability-title-area .subtitle {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.58rem;
            color: var(--text-dim);
            letter-spacing: 0.06em;
        }

        .stability-value-box {
            text-align: right;
        }

        .stability-value {
            font-family: 'Orbitron', monospace;
            font-size: 2.2rem;
            font-weight: 900;
            letter-spacing: 0.05em;
            line-height: 1;
        }

        .stability-delta {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.7rem;
            margin-top: 4px;
        }

        .delta-neg { color: var(--red); }
        .delta-pos { color: var(--green); }
        .delta-neutral { color: var(--yellow); }

        /* Stability bar */
        .stability-bar-container {
            margin-bottom: 16px;
        }

        .stability-bar {
            width: 100%;
            height: 12px;
            background: rgba(255,255,255,0.03);
            border-radius: 2px;
            overflow: hidden;
            position: relative;
        }

        .stability-bar-fill {
            height: 100%;
            border-radius: 2px;
            transition: width 1.5s ease-out, background 1.5s ease-out;
        }

        .stability-bar-threshold {
            position: absolute;
            top: -4px;
            width: 2px;
            height: 20px;
            background: var(--red);
            opacity: 0.6;
        }

        .stability-bar-threshold::after {
            content: 'CRITICAL';
            position: absolute;
            top: -14px;
            left: 4px;
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.45rem;
            color: var(--red);
            letter-spacing: 0.06em;
            white-space: nowrap;
        }

        .stability-meta {
            display: flex;
            gap: 24px;
            flex-wrap: wrap;
        }

        .stability-meta-item {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.6rem;
            color: var(--text-dim);
            letter-spacing: 0.04em;
        }

        .stability-meta-item strong {
            color: var(--text-secondary);
        }

        /* Mini stability history line */
        #miniStabilityChart {
            width: 100%;
            height: 50px;
            margin-top: 16px;
            display: block;
        }

        /* ===== LEVEL 1: SENSORY MESH ===== */
        .sensory-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 20px 24px;
            margin-bottom: 24px;
        }

        .neuron-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 14px;
        }

        .neuron-card {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            background: rgba(255,255,255,0.015);
            border: 1px solid rgba(255,255,255,0.03);
            border-radius: 3px;
            transition: all 0.3s;
        }

        .neuron-card:hover {
            border-color: var(--border-light);
            background: rgba(255,255,255,0.03);
        }

        .neuron-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            flex-shrink: 0;
            transition: all 0.5s;
        }

        .neuron-dot.active {
            background: var(--green);
            box-shadow: 0 0 6px var(--green);
        }

        .neuron-dot.firing {
            background: var(--cyan);
            box-shadow: 0 0 8px var(--cyan);
            animation: neuron-fire 0.6s infinite;
        }

        .neuron-dot.error {
            background: var(--red);
            box-shadow: 0 0 6px var(--red);
        }

        .neuron-dot.idle {
            background: var(--text-dim);
        }

        @keyframes neuron-fire {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        .neuron-info {
            flex: 1;
            min-width: 0;
        }

        .neuron-name {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.62rem;
            color: var(--text-primary);
            letter-spacing: 0.03em;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .neuron-meta {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.52rem;
            color: var(--text-dim);
            letter-spacing: 0.03em;
            display: flex;
            gap: 8px;
        }

        .neuron-weight {
            font-family: 'Orbitron', monospace;
            font-size: 0.6rem;
            font-weight: 600;
            flex-shrink: 0;
        }

        .sensory-stats {
            display: flex;
            gap: 20px;
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.58rem;
            color: var(--text-dim);
            letter-spacing: 0.04em;
            padding-top: 12px;
            border-top: 1px solid var(--border);
        }

        .sensory-stats strong {
            color: var(--text-secondary);
        }

        /* ===== LEVEL 2: SYNAPTIC ENGINE ===== */
        .synaptic-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 20px 24px;
            margin-bottom: 24px;
        }

        .pattern-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
        }

        .pattern-card {
            padding: 16px;
            background: rgba(255,255,255,0.015);
            border: 1px solid rgba(255,255,255,0.04);
            border-radius: 3px;
            text-align: center;
        }

        .pattern-label {
            font-family: 'Orbitron', monospace;
            font-size: 0.55rem;
            font-weight: 600;
            color: var(--text-dim);
            letter-spacing: 0.1em;
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        .pattern-value {
            font-family: 'Orbitron', monospace;
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 6px;
            line-height: 1;
        }

        .pattern-detail {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.55rem;
            color: var(--text-dim);
            letter-spacing: 0.03em;
        }

        .pattern-indicator {
            display: flex;
            justify-content: center;
            gap: 4px;
            margin-top: 8px;
        }

        .pattern-pip {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: rgba(255,255,255,0.08);
        }

        .pattern-pip.lit {
            background: var(--cyan);
            box-shadow: 0 0 4px var(--cyan);
        }

        .pattern-pip.warn {
            background: var(--orange);
            box-shadow: 0 0 4px var(--orange);
        }

        .pattern-pip.crit {
            background: var(--red);
            box-shadow: 0 0 4px var(--red);
        }

        /* ===== LEVEL 3: CORTICAL FIELD ===== */
        .cortical-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 20px 24px;
            margin-bottom: 24px;
        }

        .scenario-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
        }

        .scenario-card {
            padding: 18px 16px;
            background: rgba(255,255,255,0.015);
            border: 1px solid rgba(255,255,255,0.04);
            border-radius: 3px;
            text-align: center;
            position: relative;
        }

        .scenario-card.dominant {
            border-color: var(--cyan-dim);
            background: rgba(0, 200, 255, 0.03);
        }

        .scenario-name {
            font-family: 'Orbitron', monospace;
            font-size: 0.55rem;
            font-weight: 600;
            color: var(--text-dim);
            letter-spacing: 0.08em;
            text-transform: uppercase;
            margin-bottom: 12px;
        }

        .scenario-prob {
            font-family: 'Orbitron', monospace;
            font-size: 1.8rem;
            font-weight: 900;
            line-height: 1;
            margin-bottom: 8px;
        }

        .scenario-metrics {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.55rem;
            color: var(--text-dim);
            letter-spacing: 0.03em;
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .scenario-drivers {
            margin-top: 10px;
            padding-top: 8px;
            border-top: 1px solid rgba(255,255,255,0.04);
        }

        .scenario-driver-tag {
            display: inline-block;
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.48rem;
            color: var(--text-dim);
            background: rgba(255,255,255,0.03);
            padding: 2px 6px;
            border-radius: 2px;
            margin: 2px;
            letter-spacing: 0.03em;
        }

        /* ===== BOTTOM ROW: HISTORY + DIAGNOSIS ===== */
        .bottom-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 24px;
        }

        .history-section, .diagnosis-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 20px 24px;
        }

        .panel-title {
            font-family: 'Orbitron', monospace;
            font-size: 0.6rem;
            font-weight: 600;
            color: var(--text-secondary);
            letter-spacing: 0.12em;
            text-transform: uppercase;
            margin-bottom: 14px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border);
        }

        #stabilityHistoryChart {
            width: 100%;
            height: 160px;
            display: block;
        }

        .diagnosis-content {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.62rem;
            color: var(--text-dim);
            letter-spacing: 0.03em;
        }

        .diag-row {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
            align-items: flex-start;
        }

        .diag-label {
            color: var(--text-dim);
            min-width: 90px;
            text-transform: uppercase;
            font-size: 0.55rem;
            letter-spacing: 0.06em;
            padding-top: 2px;
        }

        .diag-value {
            color: var(--text-secondary);
            flex: 1;
        }

        .diag-tag {
            display: inline-block;
            font-size: 0.5rem;
            padding: 2px 6px;
            border-radius: 2px;
            margin: 1px 2px;
            letter-spacing: 0.03em;
        }

        .diag-tag.driver { background: rgba(0, 200, 255, 0.1); color: var(--cyan); border: 1px solid rgba(0, 200, 255, 0.2); }
        .diag-tag.ignored { background: rgba(255, 136, 51, 0.1); color: var(--orange); border: 1px solid rgba(255, 136, 51, 0.2); }
        .diag-tag.overest { background: rgba(136, 85, 255, 0.1); color: var(--purple); border: 1px solid rgba(136, 85, 255, 0.2); }
        .diag-tag.keyword { background: rgba(255,255,255,0.04); color: var(--text-secondary); border: 1px solid rgba(255,255,255,0.06); }

        /* ===== SIGNAL LOG ===== */
        .signal-log-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 20px 24px;
            margin-bottom: 24px;
        }

        .signal-log {
            max-height: 200px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--border) transparent;
        }

        .signal-entry {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.58rem;
            color: var(--text-dim);
            letter-spacing: 0.02em;
            padding: 4px 0;
            border-bottom: 1px solid rgba(255,255,255,0.015);
            display: flex;
            gap: 8px;
        }

        .signal-entry:last-child { border-bottom: none; }

        .signal-time { color: var(--text-dim); min-width: 60px; }
        .signal-source { color: var(--cyan-dim); min-width: 100px; }
        .signal-domain { color: var(--text-dim); min-width: 80px; text-transform: uppercase; }
        .signal-data { color: var(--text-secondary); flex: 1; }

        /* ===== STATUS FOOTER ===== */
        .status-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 24px;
            background: #050a14;
            border-top: 1px solid var(--border);
            flex-wrap: wrap;
            gap: 8px;
        }

        .status-footer-left, .status-footer-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .sf-item {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.6rem;
            color: var(--text-dim);
            letter-spacing: 0.05em;
            text-transform: uppercase;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .sf-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--green);
            box-shadow: 0 0 6px var(--green);
        }

        .sf-item .val { color: var(--text-secondary); }

        .sf-motto {
            font-family: 'Orbitron', monospace;
            font-size: 0.55rem;
            color: var(--text-dim);
            letter-spacing: 0.15em;
            text-transform: uppercase;
        }

        /* ===== BOOT OVERLAY ===== */
        .boot-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: var(--bg-deep);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.8s ease-out;
        }

        .boot-overlay.fade-out {
            opacity: 0;
            pointer-events: none;
        }

        .boot-text {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.7rem;
            color: var(--cyan);
            letter-spacing: 0.1em;
            text-align: center;
        }

        .boot-line {
            opacity: 0;
            transform: translateY(5px);
            animation: boot-appear 0.3s forwards;
            margin-bottom: 6px;
        }

        @keyframes boot-appear {
            to { opacity: 1; transform: translateY(0); }
        }

        .boot-bar {
            width: 200px;
            height: 2px;
            background: rgba(255,255,255,0.05);
            border-radius: 1px;
            margin-top: 20px;
            overflow: hidden;
        }

        .boot-bar-fill {
            width: 0%;
            height: 100%;
            background: var(--cyan);
            transition: width 0.3s;
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 1100px) {
            .pattern-grid, .scenario-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .bottom-row {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 700px) {
            .main-container { padding: 16px; }
            .pattern-grid, .scenario-grid {
                grid-template-columns: 1fr;
            }
            .neuron-grid {
                grid-template-columns: 1fr;
            }
            .stability-top {
                flex-direction: column;
                gap: 12px;
            }
            .stability-value-box { text-align: left; }
            .stability-value { font-size: 1.6rem; }
            .header-controls { display: none; }
        }
    </style>
</head>
<body>

    <!-- BOOT OVERLAY -->
    <div class="boot-overlay" id="bootOverlay">
        <div class="boot-text" id="bootText"></div>
        <div class="boot-bar"><div class="boot-bar-fill" id="bootBar"></div></div>
    </div>

    <!-- HEADER -->
    <div class="top-header">
        <div class="top-header-left">
            <div class="oracle-logo">
                <div class="pulse-icon">
                    <svg viewBox="0 0 28 28">
                        <polyline class="pulse-line" points="0,14 6,14 9,6 12,22 15,10 18,18 21,14 28,14"/>
                    </svg>
                </div>
                <div>
                    <div class="oracle-title">ORACLE v3.0</div>
                    <div class="oracle-subtitle">Ecosystem — Distributed Nervous System</div>
                </div>
            </div>
        </div>
        <div class="header-controls">
            <button class="btn-scan" id="btnScan" onclick="manualScan()">SCAN NOW</button>
            <div class="auto-toggle active" id="autoToggle" onclick="toggleAutoScan()">
                <span class="dot"></span> AUTO: <span id="autoLabel">ON</span>
            </div>
            <span class="sf-item" id="scanCounter">SCANS: <span class="val">0</span></span>
        </div>
        <div style="display: flex; gap: 12px; align-items: center;">
            <a href="index.html" class="back-link">&larr; HQ</a>
            <a href="agora.html" class="back-link" style="color: #39ff14;">AGORA</a>
            <a href="pneuma.html" class="back-link" style="color: #ff6600;">PNEUMA</a>
            <a href="urban-chronos.html" class="back-link" style="color: #00d4aa;">CHRONOS</a>
            <a href="archivio-silente.html" class="back-link" style="color: #00d4ff;">ARCHIVIO &rarr;</a>
        </div>
    </div>

    <!-- MAIN -->
    <div class="main-container">

        <!-- ===== STABILITY FIELD (HERO) ===== -->
        <div class="stability-hero" id="stabilityHero">
            <div class="stability-top">
                <div class="stability-title-area">
                    <h2>CAMPO DI STABILIT&Agrave;</h2>
                    <div class="subtitle">Tensione strutturale del sistema globale — non eventi, variazione</div>
                </div>
                <div class="stability-value-box">
                    <div class="stability-value" id="stabilityValue" style="color: var(--yellow);">0.75</div>
                    <div class="stability-delta delta-neutral" id="stabilityDelta">&Delta;: 0.0000/scan</div>
                </div>
            </div>

            <div class="stability-bar-container">
                <div class="stability-bar">
                    <div class="stability-bar-fill" id="stabilityBarFill" style="width: 75%; background: linear-gradient(90deg, var(--teal), var(--cyan));"></div>
                    <div class="stability-bar-threshold" id="stabilityThreshold" style="left: 35%;"></div>
                </div>
            </div>

            <div class="stability-meta" id="stabilityMeta">
                <div class="stability-meta-item">TREND: <strong id="metaTrend">INITIALIZING</strong></div>
                <div class="stability-meta-item">THRESHOLD: <strong>0.35</strong></div>
                <div class="stability-meta-item">DISTANCE: <strong id="metaDistance">0.40</strong></div>
                <div class="stability-meta-item">NEURONS: <strong id="metaNeurons">0/0</strong></div>
                <div class="stability-meta-item">LAST SCAN: <strong id="metaLastScan">NEVER</strong></div>
            </div>

            <canvas id="miniStabilityChart"></canvas>
        </div>

        <!-- ===== LEVEL 1: SENSORY MESH ===== -->
        <div class="section-label"><span class="level-num">01</span> RETE SENSORIALE — Raw Intelligence Mesh</div>
        <div class="sensory-section" id="sensorySection">
            <div class="neuron-grid" id="neuronGrid">
                <!-- Populated by JS -->
            </div>
            <div class="sensory-stats" id="sensoryStats">
                <div>ACTIVE: <strong id="statActive">0/0</strong></div>
                <div>SIGNALS: <strong id="statSignals">0</strong></div>
                <div>AVG LATENCY: <strong id="statLatency">0ms</strong></div>
                <div>MEMORY: <strong id="statMemory">0 records</strong></div>
            </div>
        </div>

        <!-- ===== LEVEL 2: SYNAPTIC ENGINE ===== -->
        <div class="section-label"><span class="level-num">02</span> MOTORE SINAPTICO — Signal Compression Engine</div>
        <div class="synaptic-section" id="synapticSection">
            <div class="pattern-grid">
                <!-- Simultaneous Shocks -->
                <div class="pattern-card" id="patShocks">
                    <div class="pattern-label">SHOCK SIMULTANEI</div>
                    <div class="pattern-value" style="color: var(--text-dim);">0</div>
                    <div class="pattern-detail">domini elevati</div>
                    <div class="pattern-indicator">
                        <div class="pattern-pip"></div>
                        <div class="pattern-pip"></div>
                        <div class="pattern-pip"></div>
                        <div class="pattern-pip"></div>
                        <div class="pattern-pip"></div>
                    </div>
                </div>
                <!-- Rhythm Acceleration -->
                <div class="pattern-card" id="patAcceleration">
                    <div class="pattern-label">ACCELERAZIONE</div>
                    <div class="pattern-value" style="color: var(--text-dim);">0.00</div>
                    <div class="pattern-detail">rate of change</div>
                    <div class="pattern-indicator">
                        <div class="pattern-pip"></div>
                        <div class="pattern-pip"></div>
                        <div class="pattern-pip"></div>
                        <div class="pattern-pip"></div>
                        <div class="pattern-pip"></div>
                    </div>
                </div>
                <!-- Polarization -->
                <div class="pattern-card" id="patPolarization">
                    <div class="pattern-label">POLARIZZAZIONE</div>
                    <div class="pattern-value" style="color: var(--text-dim);">0.00</div>
                    <div class="pattern-detail">sentiment variance</div>
                    <div class="pattern-indicator">
                        <div class="pattern-pip"></div>
                        <div class="pattern-pip"></div>
                        <div class="pattern-pip"></div>
                        <div class="pattern-pip"></div>
                        <div class="pattern-pip"></div>
                    </div>
                </div>
                <!-- Cross-Domain Correlation -->
                <div class="pattern-card" id="patCorrelation">
                    <div class="pattern-label">CROSS-DOMINIO</div>
                    <div class="pattern-value" style="color: var(--text-dim);">0.00</div>
                    <div class="pattern-detail">correlation factor</div>
                    <div class="pattern-indicator">
                        <div class="pattern-pip"></div>
                        <div class="pattern-pip"></div>
                        <div class="pattern-pip"></div>
                        <div class="pattern-pip"></div>
                        <div class="pattern-pip"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== LEVEL 3: CORTICAL FIELD ===== -->
        <div class="section-label"><span class="level-num">03</span> CAMPO CORTICALE — Scenario Probability Field</div>
        <div class="cortical-section" id="corticalSection">
            <div class="scenario-grid" id="scenarioGrid">
                <div class="scenario-card" id="scenSoft">
                    <div class="scenario-name">ESCALAZIONE SOFT</div>
                    <div class="scenario-prob" style="color: var(--orange);">—</div>
                    <div class="scenario-metrics">
                        <span>H: — | C: —</span>
                    </div>
                    <div class="scenario-drivers" id="driversSoft"></div>
                </div>
                <div class="scenario-card" id="scenCascade">
                    <div class="scenario-name">CASCATA REGIONALE</div>
                    <div class="scenario-prob" style="color: var(--red);">—</div>
                    <div class="scenario-metrics">
                        <span>H: — | C: —</span>
                    </div>
                    <div class="scenario-drivers" id="driversCascade"></div>
                </div>
                <div class="scenario-card" id="scenAbsorb">
                    <div class="scenario-name">ASSORBIMENTO</div>
                    <div class="scenario-prob" style="color: var(--teal);">—</div>
                    <div class="scenario-metrics">
                        <span>H: — | C: —</span>
                    </div>
                    <div class="scenario-drivers" id="driversAbsorb"></div>
                </div>
                <div class="scenario-card" id="scenFalse">
                    <div class="scenario-name">FALSO ALLARME</div>
                    <div class="scenario-prob" style="color: var(--text-dim);">—</div>
                    <div class="scenario-metrics">
                        <span>H: — | C: —</span>
                    </div>
                    <div class="scenario-drivers" id="driversFalse"></div>
                </div>
            </div>
        </div>

        <!-- ===== BOTTOM ROW ===== -->
        <div class="bottom-row">
            <!-- Stability History -->
            <div class="history-section">
                <div class="panel-title">STORIA CAMPO DI STABILIT&Agrave;</div>
                <canvas id="stabilityHistoryChart"></canvas>
            </div>

            <!-- Auto-Diagnosis -->
            <div class="diagnosis-section">
                <div class="panel-title">AUTO-DIAGNOSI</div>
                <div class="diagnosis-content" id="diagnosisContent">
                    <div class="diag-row">
                        <span class="diag-label">Status</span>
                        <span class="diag-value">Waiting for first scan...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== SIGNAL LOG ===== -->
        <div class="signal-log-section">
            <div class="panel-title">LOG SEGNALI — Raw Neuron Output</div>
            <div class="signal-log" id="signalLog">
                <div class="signal-entry">
                    <span class="signal-time">--:--:--</span>
                    <span class="signal-source">SYSTEM</span>
                    <span class="signal-domain">INIT</span>
                    <span class="signal-data">Waiting for first scan...</span>
                </div>
            </div>
        </div>

    </div>

    <!-- STATUS FOOTER -->
    <div class="status-footer">
        <div class="status-footer-left">
            <div class="sf-item"><span class="sf-dot"></span> ENGINE: <span class="val" id="footerEngine">INIT</span></div>
            <div class="sf-item">MEMORY: <span class="val" id="footerMemory">IndexedDB</span></div>
            <div class="sf-item">VERSION: <span class="val">3.0.0-ECOSYSTEM</span></div>
        </div>
        <div class="status-footer-right">
            <div class="sf-motto">TENSIONE, NON EVENTI</div>
            <div class="sf-item">PARADIGM: <span class="val">BROWSER-NATIVE</span></div>
        </div>
    </div>

    <!-- ENGINE -->
    <script src="js/oracle-engine.js"></script>

    <!-- UI LOGIC -->
    <script>
    // =========================================================
    // ORACLE UI v3.0 — Interface for the Nervous System
    // =========================================================

    let autoScanEnabled = true;
    let bootComplete = false;

    // ===== BOOT SEQUENCE =====
    async function bootSequence() {
        const overlay = document.getElementById('bootOverlay');
        const textEl = document.getElementById('bootText');
        const barEl = document.getElementById('bootBar');

        const lines = [
            'ORACLE ECOSYSTEM v3.0',
            'Initializing IndexedDB memory layer...',
            'Loading neuron definitions...',
            'Calibrating sensory mesh...',
            'Synaptic engine: STANDBY',
            'Cortical field: STANDBY',
            'Auto-diagnosis: ARMED',
            'Connecting to distributed intelligence...',
            'First scan initiating...'
        ];

        for (let i = 0; i < lines.length; i++) {
            const line = document.createElement('div');
            line.className = 'boot-line';
            line.style.animationDelay = '0s';
            line.textContent = (i === 0 ? '' : '> ') + lines[i];
            if (i === 0) line.style.marginBottom = '14px';
            textEl.appendChild(line);
            barEl.style.width = ((i + 1) / lines.length * 100) + '%';
            await sleep(250 + Math.random() * 150);
        }

        // Initialize engine
        const success = await OracleEngine.init();

        if (success) {
            const done = document.createElement('div');
            done.className = 'boot-line';
            done.textContent = '> ECOSYSTEM ONLINE';
            done.style.color = '#00dd66';
            textEl.appendChild(done);
        } else {
            const fail = document.createElement('div');
            fail.className = 'boot-line';
            fail.textContent = '> ENGINE INIT FAILED — Running in degraded mode';
            fail.style.color = '#ff3344';
            textEl.appendChild(fail);
        }

        barEl.style.width = '100%';
        await sleep(600);

        overlay.classList.add('fade-out');
        setTimeout(() => overlay.remove(), 800);

        bootComplete = true;
        renderNeuronGrid();
        document.getElementById('footerEngine').textContent = success ? 'ONLINE' : 'DEGRADED';

        // Register update listener
        OracleEngine.onUpdate(handleEngineUpdate);

        // First scan
        await OracleEngine.scan();

        // Start auto-scan
        if (autoScanEnabled) {
            OracleEngine.startAutoScan();
        }
    }

    function sleep(ms) {
        return new Promise(r => setTimeout(r, ms));
    }

    // ===== ENGINE UPDATE HANDLER =====
    function handleEngineUpdate(event, state, data) {
        if (event === 'scan-start') {
            document.getElementById('btnScan').classList.add('scanning');
            document.getElementById('btnScan').disabled = true;
            document.getElementById('btnScan').textContent = 'SCANNING...';
            updateNeuronStatus();
        }

        if (event === 'scan-complete') {
            document.getElementById('btnScan').classList.remove('scanning');
            document.getElementById('btnScan').disabled = false;
            document.getElementById('btnScan').textContent = 'SCAN NOW';

            updateStabilityField(state);
            updateNeuronGrid(state);
            updateSynapticDisplay(state);
            updateCorticalField(state);
            updateDiagnosis(state);
            updateSignalLog(state);
            updateMiniChart();
            updateHistoryChart();
            updateFooter(state);
        }

        if (event === 'scan-error') {
            document.getElementById('btnScan').classList.remove('scanning');
            document.getElementById('btnScan').disabled = false;
            document.getElementById('btnScan').textContent = 'SCAN NOW';
            addSignalLogEntry('ERROR', 'ENGINE', 'SYSTEM', 'Scan failed: ' + (data || 'Unknown error'));
        }
    }

    // ===== STABILITY FIELD DISPLAY =====
    function updateStabilityField(state) {
        const s = state.stability;
        const d = state.delta;

        // Color based on stability
        let color;
        if (s > 0.7) color = 'var(--green)';
        else if (s > 0.5) color = 'var(--cyan)';
        else if (s > 0.35) color = 'var(--yellow)';
        else color = 'var(--red)';

        const valEl = document.getElementById('stabilityValue');
        valEl.textContent = s.toFixed(2);
        valEl.style.color = color;

        // Delta
        const deltaEl = document.getElementById('stabilityDelta');
        const deltaSign = d >= 0 ? '+' : '';
        deltaEl.textContent = '\u0394: ' + deltaSign + d.toFixed(4) + '/scan';
        deltaEl.className = 'stability-delta ' + (d < -0.01 ? 'delta-neg' : d > 0.01 ? 'delta-pos' : 'delta-neutral');

        // Bar
        const barFill = document.getElementById('stabilityBarFill');
        barFill.style.width = (s * 100) + '%';
        if (s > 0.7) barFill.style.background = 'linear-gradient(90deg, var(--green), var(--teal))';
        else if (s > 0.5) barFill.style.background = 'linear-gradient(90deg, var(--teal), var(--cyan))';
        else if (s > 0.35) barFill.style.background = 'linear-gradient(90deg, var(--yellow), var(--orange))';
        else barFill.style.background = 'linear-gradient(90deg, var(--orange), var(--red))';

        // Meta
        const trend = d < -0.02 ? 'DECLINING' : d > 0.02 ? 'IMPROVING' : 'STABLE';
        document.getElementById('metaTrend').textContent = trend;
        document.getElementById('metaTrend').style.color = d < -0.02 ? 'var(--red)' : d > 0.02 ? 'var(--green)' : 'var(--yellow)';
        document.getElementById('metaDistance').textContent = (s - 0.35).toFixed(2);
        document.getElementById('metaLastScan').textContent = formatTime(state.lastScan);
        document.getElementById('scanCounter').querySelector('.val').textContent = state.scanCount;

        const activeNeurons = state.signals ? state.signals.filter(s2 => s2.meta.success).length : 0;
        const totalNeurons = state.signals ? state.signals.length : 0;
        document.getElementById('metaNeurons').textContent = activeNeurons + '/' + totalNeurons;
    }

    // ===== NEURON GRID =====
    function renderNeuronGrid() {
        const grid = document.getElementById('neuronGrid');
        grid.innerHTML = '';
        for (const neuron of SensoryMesh.neurons) {
            const card = document.createElement('div');
            card.className = 'neuron-card';
            card.id = 'neuron-' + neuron.id;
            card.innerHTML = `
                <div class="neuron-dot idle"></div>
                <div class="neuron-info">
                    <div class="neuron-name">${neuron.name}</div>
                    <div class="neuron-meta">
                        <span>${neuron.domain}</span>
                        <span>r:${neuron.reliability.toFixed(2)}</span>
                    </div>
                </div>
                <div class="neuron-weight" style="color: var(--text-dim);">${neuron.weight.toFixed(2)}</div>
            `;
            grid.appendChild(card);
        }
    }

    function updateNeuronStatus() {
        for (const neuron of SensoryMesh.neurons) {
            const card = document.getElementById('neuron-' + neuron.id);
            if (card) {
                const dot = card.querySelector('.neuron-dot');
                dot.className = 'neuron-dot firing';
            }
        }
    }

    function updateNeuronGrid(state) {
        let active = 0;
        let totalLatency = 0;
        let latencyCount = 0;

        for (const neuron of SensoryMesh.neurons) {
            const card = document.getElementById('neuron-' + neuron.id);
            if (!card) continue;

            const dot = card.querySelector('.neuron-dot');
            dot.className = 'neuron-dot ' + neuron.status;

            const meta = card.querySelector('.neuron-meta');
            meta.innerHTML = `<span>${neuron.domain}</span><span>r:${neuron.reliability.toFixed(2)}</span>`;

            const weightEl = card.querySelector('.neuron-weight');
            weightEl.textContent = neuron.weight.toFixed(2);
            if (neuron.weight > 0.7) weightEl.style.color = 'var(--green)';
            else if (neuron.weight > 0.4) weightEl.style.color = 'var(--cyan)';
            else weightEl.style.color = 'var(--orange)';

            if (neuron.status === 'active') active++;
            if (neuron.latency > 0) {
                totalLatency += neuron.latency;
                latencyCount++;
            }
        }

        document.getElementById('statActive').textContent = active + '/' + SensoryMesh.neurons.length;
        document.getElementById('statLatency').textContent = latencyCount > 0 ? Math.round(totalLatency / latencyCount) + 'ms' : '—';

        const totalSignals = state.signals ? state.signals.reduce((s, sig) => s + sig.itemCount, 0) : 0;
        document.getElementById('statSignals').textContent = totalSignals;
    }

    // ===== SYNAPTIC DISPLAY =====
    function updateSynapticDisplay(state) {
        if (!state.patterns) return;
        const p = state.patterns;

        // Shocks
        updatePatternCard('patShocks', p.shocks.count, p.shocks.count + ' domini', p.shocks.factor);
        // Acceleration
        const accSign = p.acceleration.rate >= 0 ? '+' : '';
        updatePatternCard('patAcceleration', accSign + p.acceleration.rate.toFixed(2), p.acceleration.accelerating ? 'ACCELERATING' : 'STABLE', Math.abs(p.acceleration.rate) * 3);
        // Polarization
        updatePatternCard('patPolarization', p.polarization.variance.toFixed(3), p.polarization.polarized ? 'POLARIZED' : 'CONVERGENT', p.polarization.variance * 4);
        // Cross-correlation
        updatePatternCard('patCorrelation', p.crossCorrelation.correlation.toFixed(2), p.crossCorrelation.pairs.length + ' pairs', p.crossCorrelation.correlation);
    }

    function updatePatternCard(id, value, detail, intensity) {
        const card = document.getElementById(id);
        if (!card) return;

        const valEl = card.querySelector('.pattern-value');
        valEl.textContent = value;
        if (intensity > 0.7) valEl.style.color = 'var(--red)';
        else if (intensity > 0.4) valEl.style.color = 'var(--orange)';
        else if (intensity > 0.15) valEl.style.color = 'var(--cyan)';
        else valEl.style.color = 'var(--text-dim)';

        card.querySelector('.pattern-detail').textContent = detail;

        // Update pips
        const pips = card.querySelectorAll('.pattern-pip');
        const litCount = Math.min(5, Math.ceil(intensity * 5));
        pips.forEach((pip, i) => {
            if (i < litCount) {
                if (intensity > 0.7) pip.className = 'pattern-pip crit';
                else if (intensity > 0.4) pip.className = 'pattern-pip warn';
                else pip.className = 'pattern-pip lit';
            } else {
                pip.className = 'pattern-pip';
            }
        });
    }

    // ===== CORTICAL FIELD =====
    function updateCorticalField(state) {
        if (!state.scenarios) return;
        const sc = state.scenarios;

        updateScenarioCard('scenSoft', sc.softEscalation, 'var(--orange)', 'driversSoft');
        updateScenarioCard('scenCascade', sc.regionalCascade, 'var(--red)', 'driversCascade');
        updateScenarioCard('scenAbsorb', sc.absorption, 'var(--teal)', 'driversAbsorb');
        updateScenarioCard('scenFalse', sc.falseAlarm, 'var(--text-dim)', 'driversFalse');

        // Mark dominant scenario
        const scenarios = [
            { id: 'scenSoft', p: sc.softEscalation.probability },
            { id: 'scenCascade', p: sc.regionalCascade.probability },
            { id: 'scenAbsorb', p: sc.absorption.probability },
            { id: 'scenFalse', p: sc.falseAlarm.probability }
        ];
        const max = scenarios.reduce((a, b) => a.p > b.p ? a : b);
        scenarios.forEach(s => {
            document.getElementById(s.id).classList.toggle('dominant', s.id === max.id);
        });
    }

    function updateScenarioCard(cardId, scenario, color, driversId) {
        const card = document.getElementById(cardId);
        if (!card) return;

        const prob = card.querySelector('.scenario-prob');
        prob.textContent = Math.round(scenario.probability * 100) + '%';
        prob.style.color = color;

        const metrics = card.querySelector('.scenario-metrics span');
        metrics.textContent = 'H: ' + scenario.entropy.toFixed(2) + ' | C: ' + scenario.confidence.toFixed(2);

        const driversEl = document.getElementById(driversId);
        if (driversEl) {
            driversEl.innerHTML = scenario.drivers
                .map(d => '<span class="scenario-driver-tag">' + d + '</span>')
                .join('');
        }
    }

    // ===== DIAGNOSIS =====
    function updateDiagnosis(state) {
        if (!state.diagnosis) return;
        const d = state.diagnosis;
        const el = document.getElementById('diagnosisContent');

        let html = '';

        // Direction
        const dirColor = d.direction === 'deteriorating' ? 'var(--red)' : d.direction === 'improving' ? 'var(--green)' : 'var(--yellow)';
        html += `<div class="diag-row"><span class="diag-label">Direction</span><span class="diag-value" style="color:${dirColor}">${d.direction.toUpperCase()} (\u0394${d.delta >= 0 ? '+' : ''}${d.delta.toFixed(4)})</span></div>`;

        // Neurons
        html += `<div class="diag-row"><span class="diag-label">Neurons</span><span class="diag-value">${d.activeNeurons}/${d.totalNeurons} active</span></div>`;

        // Drivers
        if (d.drivers.length > 0) {
            html += '<div class="diag-row"><span class="diag-label">Drivers</span><span class="diag-value">';
            for (const dr of d.drivers) {
                html += `<span class="diag-tag driver">${dr.type} (${typeof dr.impact === 'number' ? dr.impact.toFixed(2) : dr.impact})</span>`;
            }
            html += '</span></div>';
        }

        // Ignored signals
        if (d.ignored.length > 0) {
            html += '<div class="diag-row"><span class="diag-label">Ignored</span><span class="diag-value">';
            for (const ig of d.ignored) {
                html += `<span class="diag-tag ignored">${ig.neuronId} (u:${ig.urgency.toFixed(2)})</span>`;
            }
            html += '</span></div>';
        }

        // Overestimated
        if (d.overestimated.length > 0) {
            html += '<div class="diag-row"><span class="diag-label">Overest.</span><span class="diag-value">';
            for (const ov of d.overestimated) {
                html += `<span class="diag-tag overest">${ov.neuronId} (u:${ov.urgency.toFixed(2)})</span>`;
            }
            html += '</span></div>';
        }

        // Top Keywords
        if (d.topKeywords.length > 0) {
            html += '<div class="diag-row"><span class="diag-label">Keywords</span><span class="diag-value">';
            for (const kw of d.topKeywords) {
                html += `<span class="diag-tag keyword">${kw.keyword} (${kw.count})</span>`;
            }
            html += '</span></div>';
        }

        el.innerHTML = html;
    }

    // ===== SIGNAL LOG =====
    function updateSignalLog(state) {
        if (!state.signals) return;
        for (const sig of state.signals) {
            const urgStr = 'u:' + sig.aggregate.urgency.toFixed(2);
            const sentStr = 's:' + sig.aggregate.sentiment.toFixed(2);
            const kws = sig.aggregate.dominantKeywords.slice(0, 3).join(', ');
            const status = sig.meta.success ? `${urgStr} ${sentStr} [${kws || 'no keywords'}]` : 'FETCH FAILED: ' + (sig.meta.error || 'timeout');
            addSignalLogEntry(formatTime(sig.timestamp), sig.neuronId, sig.domain, status);
        }
    }

    function addSignalLogEntry(time, source, domain, data) {
        const log = document.getElementById('signalLog');
        const entry = document.createElement('div');
        entry.className = 'signal-entry';
        entry.innerHTML = `
            <span class="signal-time">${time}</span>
            <span class="signal-source">${source}</span>
            <span class="signal-domain">${domain}</span>
            <span class="signal-data">${data}</span>
        `;
        log.appendChild(entry);

        // Keep max 50 entries
        while (log.children.length > 50) {
            log.removeChild(log.firstChild);
        }

        log.scrollTop = log.scrollHeight;
    }

    // ===== MINI STABILITY CHART (in hero) =====
    async function updateMiniChart() {
        const canvas = document.getElementById('miniStabilityChart');
        const ctx = canvas.getContext('2d');
        const dpr = window.devicePixelRatio || 1;
        const rect = canvas.getBoundingClientRect();
        canvas.width = rect.width * dpr;
        canvas.height = rect.height * dpr;
        ctx.scale(dpr, dpr);

        const W = rect.width;
        const H = rect.height;

        ctx.clearRect(0, 0, W, H);

        const history = await OracleEngine.getStabilityHistory(50);
        if (history.length < 2) return;

        const padX = 4;
        const padY = 4;
        const chartW = W - padX * 2;
        const chartH = H - padY * 2;

        // Threshold line
        const threshY = padY + chartH * (1 - ORACLE_CONFIG.CRITICAL_THRESHOLD);
        ctx.strokeStyle = 'rgba(255, 51, 68, 0.2)';
        ctx.lineWidth = 1;
        ctx.setLineDash([4, 4]);
        ctx.beginPath();
        ctx.moveTo(padX, threshY);
        ctx.lineTo(W - padX, threshY);
        ctx.stroke();
        ctx.setLineDash([]);

        // Stability line
        ctx.beginPath();
        ctx.strokeStyle = 'rgba(0, 200, 255, 0.6)';
        ctx.lineWidth = 1.5;

        const step = chartW / (history.length - 1);
        for (let i = 0; i < history.length; i++) {
            const x = padX + step * i;
            const y = padY + chartH * (1 - history[i].stability);
            if (i === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
        }
        ctx.stroke();

        // Area fill
        ctx.lineTo(padX + step * (history.length - 1), padY + chartH);
        ctx.lineTo(padX, padY + chartH);
        ctx.closePath();
        const grad = ctx.createLinearGradient(0, 0, 0, H);
        grad.addColorStop(0, 'rgba(0, 200, 255, 0.08)');
        grad.addColorStop(1, 'rgba(0, 200, 255, 0)');
        ctx.fillStyle = grad;
        ctx.fill();
    }

    // ===== STABILITY HISTORY CHART =====
    async function updateHistoryChart() {
        const canvas = document.getElementById('stabilityHistoryChart');
        const ctx = canvas.getContext('2d');
        const dpr = window.devicePixelRatio || 1;
        const rect = canvas.getBoundingClientRect();
        canvas.width = rect.width * dpr;
        canvas.height = rect.height * dpr;
        ctx.scale(dpr, dpr);

        const W = rect.width;
        const H = rect.height;
        const padLeft = 40;
        const padRight = 10;
        const padTop = 10;
        const padBottom = 20;
        const chartW = W - padLeft - padRight;
        const chartH = H - padTop - padBottom;

        ctx.clearRect(0, 0, W, H);

        // Grid
        ctx.strokeStyle = 'rgba(255,255,255,0.04)';
        ctx.lineWidth = 1;
        for (let i = 0; i <= 5; i++) {
            const y = padTop + (chartH / 5) * i;
            ctx.beginPath();
            ctx.moveTo(padLeft, y);
            ctx.lineTo(W - padRight, y);
            ctx.stroke();
        }

        // Y labels
        ctx.fillStyle = '#3a4f6f';
        ctx.font = '9px Share Tech Mono';
        ctx.textAlign = 'right';
        for (let i = 0; i <= 5; i++) {
            const val = (1.0 - i * 0.2).toFixed(1);
            const y = padTop + (chartH / 5) * i;
            ctx.fillText(val, padLeft - 6, y + 3);
        }

        // Threshold line
        const threshY = padTop + chartH * (1 - ORACLE_CONFIG.CRITICAL_THRESHOLD);
        ctx.strokeStyle = 'rgba(255, 51, 68, 0.3)';
        ctx.lineWidth = 1;
        ctx.setLineDash([6, 4]);
        ctx.beginPath();
        ctx.moveTo(padLeft, threshY);
        ctx.lineTo(W - padRight, threshY);
        ctx.stroke();
        ctx.setLineDash([]);

        ctx.fillStyle = 'rgba(255, 51, 68, 0.4)';
        ctx.font = '8px Share Tech Mono';
        ctx.textAlign = 'left';
        ctx.fillText('CRITICAL', padLeft + 4, threshY - 4);

        const history = await OracleEngine.getStabilityHistory(100);
        if (history.length < 2) {
            ctx.fillStyle = '#3a4f6f';
            ctx.font = '11px Share Tech Mono';
            ctx.textAlign = 'center';
            ctx.fillText('Accumulating data...', W / 2, H / 2);
            return;
        }

        // Draw stability line
        ctx.beginPath();
        ctx.lineWidth = 2;

        const step = chartW / (history.length - 1);
        for (let i = 0; i < history.length; i++) {
            const x = padLeft + step * i;
            const y = padTop + chartH * (1 - history[i].stability);

            // Color segments
            const s = history[i].stability;
            if (s > 0.7) ctx.strokeStyle = '#00dd66';
            else if (s > 0.5) ctx.strokeStyle = '#00c8ff';
            else if (s > 0.35) ctx.strokeStyle = '#ffcc00';
            else ctx.strokeStyle = '#ff3344';

            if (i === 0) ctx.moveTo(x, y);
            else {
                ctx.lineTo(x, y);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(x, y);
            }
        }
        ctx.stroke();

        // Current value dot
        if (history.length > 0) {
            const last = history[history.length - 1];
            const lx = padLeft + step * (history.length - 1);
            const ly = padTop + chartH * (1 - last.stability);
            ctx.beginPath();
            ctx.arc(lx, ly, 3, 0, Math.PI * 2);
            ctx.fillStyle = last.stability > 0.5 ? '#00c8ff' : '#ff3344';
            ctx.fill();
            ctx.strokeStyle = last.stability > 0.5 ? 'rgba(0, 200, 255, 0.3)' : 'rgba(255, 51, 68, 0.3)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.arc(lx, ly, 6, 0, Math.PI * 2);
            ctx.stroke();
        }

        // Time labels
        if (history.length > 1) {
            ctx.fillStyle = '#3a4f6f';
            ctx.font = '8px Share Tech Mono';
            ctx.textAlign = 'center';
            const first = history[0];
            const last = history[history.length - 1];
            ctx.fillText(formatTime(first.timestamp), padLeft, H - 4);
            ctx.fillText(formatTime(last.timestamp), W - padRight, H - 4);
        }
    }

    // ===== FOOTER UPDATE =====
    function updateFooter(state) {
        // Update memory count via IndexedDB
        if (OracleMemory.db) {
            const tx = OracleMemory.db.transaction('signals', 'readonly');
            const store = tx.objectStore('signals');
            const countReq = store.count();
            countReq.onsuccess = () => {
                document.getElementById('statMemory').textContent = countReq.result + ' records';
            };
        }
    }

    // ===== CONTROLS =====
    function manualScan() {
        if (!bootComplete) return;
        OracleEngine.scan();
    }

    function toggleAutoScan() {
        autoScanEnabled = !autoScanEnabled;
        const toggle = document.getElementById('autoToggle');
        const label = document.getElementById('autoLabel');
        if (autoScanEnabled) {
            toggle.classList.add('active');
            label.textContent = 'ON';
            OracleEngine.startAutoScan();
        } else {
            toggle.classList.remove('active');
            label.textContent = 'OFF';
            OracleEngine.stopAutoScan();
        }
    }

    // ===== UTILS =====
    function formatTime(ts) {
        if (!ts) return '--:--:--';
        const d = new Date(ts);
        return d.toTimeString().slice(0, 8);
    }

    function getStabilityColor(s) {
        if (s > 0.7) return '#00dd66';
        if (s > 0.5) return '#00c8ff';
        if (s > 0.35) return '#ffcc00';
        return '#ff3344';
    }

    // ===== RESIZE HANDLER =====
    window.addEventListener('resize', () => {
        if (bootComplete) {
            updateMiniChart();
            updateHistoryChart();
        }
    });

    // ===== CONSOLE SIGNATURE =====
    console.log('%cORACLE v3.0', 'color: #00c8ff; font-size: 16px; font-weight: bold;');
    console.log('%cECOSYSTEM — DISTRIBUTED NERVOUS SYSTEM', 'color: #ff0084; font-size: 11px;');
    console.log('%cTENSIONE, NON EVENTI', 'color: #00d4aa;');
    console.log('%cBrowser-Native \u00B7 Local Memory \u00B7 Zero Cloud', 'color: #6b7fa3; font-size: 10px;');

    // ===== START =====
    bootSequence();
    </script>
    <script src="js/core-feed.js"></script>
</body>
</html>
