<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HS | Mission Control Hub</title>
    <link rel="preconnect" href="https://fonts.bunny.net">
    <link href="https://fonts.bunny.net/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;500;600;700&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0a0a0f;
            --bg-panel: #0d0d14;
            --neon-cyan: #00f0ff;
            --neon-green: #39ff14;
            --neon-orange: #ff6600;
            --neon-red: #ff003c;
            --neon-gold: #ffaa00;
            --neon-purple: #a855f7;
            --neon-teal: #00d4aa;
            --neon-blue: #00d4ff;
            --text-dim: #556677;
            --text-light: #aabbcc;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background: var(--bg-dark);
            color: #e0e0e0;
            font-family: 'Rajdhani', sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Scanlines */
        body::after {
            content: '';
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(0,0,0,0.08) 2px,
                rgba(0,0,0,0.08) 4px
            );
            pointer-events: none;
            z-index: 9999;
        }

        /* Header */
        .hub-header {
            text-align: center;
            padding: 30px 20px 10px;
            border-bottom: 1px solid rgba(0,240,255,0.15);
        }

        .hub-title {
            font-family: 'Orbitron', monospace;
            font-size: clamp(1.2rem, 4vw, 2rem);
            color: var(--neon-cyan);
            text-shadow: 0 0 20px rgba(0,240,255,0.4);
            letter-spacing: 4px;
        }

        .hub-subtitle {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.7rem;
            color: var(--text-dim);
            margin-top: 6px;
            letter-spacing: 2px;
        }

        /* Status bar */
        .status-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            padding: 12px 20px;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.65rem;
            color: var(--text-dim);
            border-bottom: 1px solid rgba(0,240,255,0.08);
            flex-wrap: wrap;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--neon-green);
            box-shadow: 0 0 6px var(--neon-green);
            animation: pulse-dot 2s ease-in-out infinite;
        }

        @keyframes pulse-dot {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        /* Viewer */
        .viewer-container {
            position: relative;
            width: 100%;
            height: calc(100vh - 200px);
            min-height: 400px;
        }

        .viewer-frame {
            width: 100%;
            height: 100%;
            border: none;
            background: var(--bg-dark);
        }

        /* Loading overlay */
        .loading-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: var(--bg-dark);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
            transition: opacity 0.5s ease;
        }

        .loading-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-text {
            font-family: 'Orbitron', monospace;
            font-size: 0.9rem;
            color: var(--neon-cyan);
            letter-spacing: 3px;
            animation: blink-text 1s ease-in-out infinite;
        }

        @keyframes blink-text {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        /* Bottom nav */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(10,10,15,0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(0,240,255,0.15);
            padding: 8px 10px;
            z-index: 100;
        }

        .nav-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            margin-bottom: 6px;
        }

        .btn-control {
            background: rgba(0,240,255,0.08);
            border: 1px solid rgba(0,240,255,0.2);
            color: var(--neon-cyan);
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.7rem;
            padding: 6px 14px;
            cursor: pointer;
            transition: all 0.3s;
            letter-spacing: 1px;
        }

        .btn-control:hover, .btn-control.active {
            background: rgba(0,240,255,0.15);
            border-color: var(--neon-cyan);
            box-shadow: 0 0 10px rgba(0,240,255,0.2);
        }

        .btn-control.paused {
            color: var(--neon-orange);
            border-color: var(--neon-orange);
        }

        .current-label {
            font-family: 'Orbitron', monospace;
            font-size: 0.7rem;
            color: var(--neon-green);
            text-align: center;
            letter-spacing: 2px;
            text-shadow: 0 0 8px rgba(57,255,20,0.3);
        }

        .page-dots {
            display: flex;
            justify-content: center;
            gap: 6px;
            padding-top: 6px;
        }

        .page-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(0,240,255,0.15);
            border: 1px solid rgba(0,240,255,0.3);
            cursor: pointer;
            transition: all 0.3s;
        }

        .page-dot.active {
            background: var(--neon-cyan);
            box-shadow: 0 0 8px var(--neon-cyan);
        }

        /* Progress bar */
        .progress-bar {
            position: absolute;
            top: 0;
            left: 0;
            height: 2px;
            background: var(--neon-cyan);
            box-shadow: 0 0 8px var(--neon-cyan);
            transition: width linear;
            z-index: 11;
        }

        /* Timer display */
        .timer-display {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.65rem;
            color: var(--text-dim);
            text-align: center;
            padding-top: 4px;
        }

        /* Keep screen awake notice */
        .wake-notice {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.55rem;
            color: rgba(57,255,20,0.4);
            text-align: center;
            padding-top: 3px;
            letter-spacing: 1px;
        }
    </style>
</head>
<body>

    <div class="hub-header">
        <div class="hub-title">MISSION CONTROL</div>
        <div class="hub-subtitle">HYBRID SYNDICATE // ALL SYSTEMS MONITORING</div>
    </div>

    <div class="status-bar">
        <div class="status-item">
            <div class="status-dot"></div>
            <span>SYSTEMS ONLINE</span>
        </div>
        <div class="status-item">
            <span id="clock">--:--:--</span>
        </div>
        <div class="status-item">
            <span id="page-counter">1 / 11</span>
        </div>
        <div class="status-item">
            <span id="cycle-counter">CYCLE: 1</span>
        </div>
    </div>

    <div class="viewer-container">
        <div class="progress-bar" id="progressBar"></div>
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-text">LOADING MODULE...</div>
        </div>
        <iframe class="viewer-frame" id="viewer" sandbox="allow-scripts allow-same-origin allow-popups"></iframe>
    </div>

    <div class="bottom-nav">
        <div class="nav-controls">
            <button class="btn-control" id="btnPrev" onclick="prevPage()">&lt;</button>
            <button class="btn-control" id="btnPause" onclick="togglePause()">PAUSE</button>
            <button class="btn-control" id="btnNext" onclick="nextPage()">&gt;</button>
        </div>
        <div class="current-label" id="currentLabel">---</div>
        <div class="page-dots" id="pageDots"></div>
        <div class="timer-display" id="timerDisplay">Next rotation: --s</div>
        <div class="wake-notice">SCREEN WAKE LOCK ACTIVE // AUTO-CYCLE MODE</div>
    </div>

    <script>
        const PAGES = [
            { url: 'index.html', name: 'HOME', color: '#00f0ff' },
            { url: 'agora.html', name: 'AGORA', color: '#39ff14' },
            { url: 'oracle.html', name: 'ORACLE', color: '#a855f7' },
            { url: 'eei-predictor.html', name: 'EEI PREDICTOR', color: '#ff003c' },
            { url: 'pneuma.html', name: 'PNEUMA', color: '#ff6600' },
            { url: 'urban-chronos.html', name: 'URBAN CHRONOS', color: '#00d4aa' },
            { url: 'archivio-silente.html', name: 'ARCHIVIO SILENTE', color: '#00d4ff' },
            { url: 'bab-el-mandeb.html', name: 'BAB EL-MANDEB', color: '#ff8833' },
            { url: 'ice-italy.html', name: 'ICE ITALY', color: '#66ccff' },
            { url: 'transducer.html', name: 'TRANSDUCER', color: '#ffaa00' },
            { url: 'backbone.html', name: 'BACKBONE', color: '#ff003c' },
            { url: 'monitor.html', name: 'MONITOR', color: '#39ff14' }
        ];

        const ROTATION_SECONDS = 25;
        let currentIndex = 0;
        let isPaused = false;
        let countdown = ROTATION_SECONDS;
        let cycleCount = 1;
        let timerInterval = null;
        let wakeLock = null;

        const viewer = document.getElementById('viewer');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const progressBar = document.getElementById('progressBar');
        const currentLabel = document.getElementById('currentLabel');
        const pageDots = document.getElementById('pageDots');
        const pageCounter = document.getElementById('page-counter');
        const cycleCounter = document.getElementById('cycle-counter');
        const timerDisplay = document.getElementById('timerDisplay');
        const btnPause = document.getElementById('btnPause');

        // Build dots
        PAGES.forEach((page, i) => {
            const dot = document.createElement('div');
            dot.className = 'page-dot' + (i === 0 ? ' active' : '');
            dot.style.borderColor = page.color;
            dot.onclick = () => goToPage(i);
            pageDots.appendChild(dot);
        });

        function loadPage(index) {
            loadingOverlay.classList.remove('hidden');
            currentLabel.textContent = PAGES[index].name;
            currentLabel.style.color = PAGES[index].color;
            currentLabel.style.textShadow = `0 0 8px ${PAGES[index].color}40`;
            pageCounter.textContent = `${index + 1} / ${PAGES.length}`;

            // Update dots
            document.querySelectorAll('.page-dot').forEach((dot, i) => {
                dot.classList.toggle('active', i === index);
                if (i === index) {
                    dot.style.background = PAGES[i].color;
                    dot.style.boxShadow = `0 0 8px ${PAGES[i].color}`;
                } else {
                    dot.style.background = 'rgba(0,240,255,0.15)';
                    dot.style.boxShadow = 'none';
                }
            });

            viewer.src = PAGES[index].url;
            viewer.onload = () => {
                setTimeout(() => loadingOverlay.classList.add('hidden'), 300);
            };

            countdown = ROTATION_SECONDS;
            updateProgress();
        }

        function updateProgress() {
            const pct = ((ROTATION_SECONDS - countdown) / ROTATION_SECONDS) * 100;
            progressBar.style.width = pct + '%';
            progressBar.style.transition = 'width 1s linear';
            timerDisplay.textContent = isPaused ? 'PAUSED' : `Next: ${countdown}s`;
        }

        function nextPage() {
            currentIndex = (currentIndex + 1) % PAGES.length;
            if (currentIndex === 0) {
                cycleCount++;
                cycleCounter.textContent = `CYCLE: ${cycleCount}`;
            }
            loadPage(currentIndex);
        }

        function prevPage() {
            currentIndex = (currentIndex - 1 + PAGES.length) % PAGES.length;
            loadPage(currentIndex);
        }

        function goToPage(index) {
            currentIndex = index;
            loadPage(currentIndex);
        }

        function togglePause() {
            isPaused = !isPaused;
            btnPause.textContent = isPaused ? 'PLAY' : 'PAUSE';
            btnPause.classList.toggle('paused', isPaused);
            updateProgress();
        }

        // Clock
        function updateClock() {
            const now = new Date();
            document.getElementById('clock').textContent =
                now.toLocaleTimeString('it-IT', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
        }

        // Timer
        function tick() {
            updateClock();
            if (!isPaused) {
                countdown--;
                updateProgress();
                if (countdown <= 0) {
                    nextPage();
                }
            }
        }

        // Wake Lock API - keep screen on
        async function requestWakeLock() {
            try {
                if ('wakeLock' in navigator) {
                    wakeLock = await navigator.wakeLock.request('screen');
                    wakeLock.addEventListener('release', () => {
                        // Re-acquire on visibility change
                    });
                }
            } catch (err) {
                // Wake Lock not supported or denied
            }
        }

        // Re-acquire wake lock when page becomes visible again
        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'visible') {
                requestWakeLock();
            }
        });

        // Prevent screen sleep fallback - subtle animation
        function keepAlive() {
            document.title = document.title === 'HS | Mission Control Hub'
                ? 'HS | ' + PAGES[currentIndex].name
                : 'HS | Mission Control Hub';
        }

        // Init
        loadPage(0);
        updateClock();
        requestWakeLock();
        timerInterval = setInterval(tick, 1000);
        setInterval(keepAlive, 30000);
    </script>
</body>
</html>
